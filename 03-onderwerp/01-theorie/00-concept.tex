\chapter{Puppet}

\section{Concept}
Het concept van configuration management is in weze simpel: het centraal bewaren en beheren van configuraties zodat deze herbruikt kunnen worden door meerdere clients. Stel het je maar eens voor, je bent een operator en je job bestaat uit het beheren van een netwerk of zelfs meerdere netwerken van machines. Dit kan gaan over een simpel thuisnetwerk ( 5-10 pc's ), over een iets geavanceerder kmo-netwerk ( 50-100 pc's ), tot zelfs een bedrijfsnetwerk van een multinational ( +1000 pc's ). Wat als jij de enige beheerder bent van zulk een netwerk? Er komt een nieuwe software-update uit voor een missie-kritieke applicatie of een kwetsbaarheid in je besturingssysteem en het is jouw job om te verzekeren dat elke computer binnen het netwerk deze update krijgt. Met wat geluk kan je dit automatiseren, ervan uitgaande dat dit altijd goed verloopt. Indien dit niet het geval is is de enige resterende optie manuele installatie van de update op elke computer. Tegen de tijd dat je rond bent kan je opnieuw beginnen en dan hebben we het enkel over onderhoud, de rest van je job dient dan ook nog gedaan te worden.\\\\
%
Een configuration management tool kan je dan helpen om dit immense aantal servers en clients te beheren op een min of meer geautomatiseerde manier. Bij puppet is het de bedoeling dat je "manifests" schrijft. Dit zijn configuratie-files waarin je bijvoorbeeld kan specifieren welke services, software-paketten en bestanden aanwezig of juist afwezig moeten zijn op een bepaald systeem en hoe deze ingesteld moeten worden. Via een speciale node-definitie kan je dan aangeven welke classes een bepaald systeem moet meekrijgen. Een simpel voorbeeld is een webserver: hierop moet een applicatie draaien die het serven van web-pagina's mogelijk maakt, zoals apache. Met puppet kunnen we niet alleen verzekeren dat dit pakket aanwezig en ge\"installeerd is op het doelsysteem, maar ook dat apache automatisch mee opstart en dat de configuratie ervan volgens een bepaalde template verloopt of van een andere server word gedownload.\\\\

\section{Onderdelen}

\subsection{Puppet}
Puppet is de naam van het commando dat men gebruikt om puppetruns te maken. Dit wil zeggen dat deze applicatie geen verbinding maakt met een puppetmaster om zijn configuratie op te halen. Omdat het puppet programma geen verbinding maakt met een server om zijn configuratie op te halen, dien je wel als argument het pad naar een manifest mee te geven. Deze manifest heeft dezelfde opmaak als een gewone manifest en wordt dan ook hetzelfde ge\"interpreteerd.

\subsection{Puppetd}
Puppetd is de puppet daemon. Daemon is de UNIX benaming voor een service, zoals verwacht is deze puppetd dan ook een service die op geregelde tijdstippen zijn configuratie binnenhaalt van een puppetmaster en uitvoert.

\subsection{Puppetmaster}
puppetmaster is de naam van de puppet-server daemon. Dit wil zeggen dat we hier te maken hebben met een service die als server een dienst aanbiedt. In dit geval is die dienst het aanbieden van manifests aan clients en hierbij gebruik te maken van een beveiligd kanaal. Dit beveiligd kanaal wordt toegepast door een ssl-verbinding aan te leggen, meer info hierover later.

\subsection{SSL}
Het volgende onderdeel van puppet is SSL. SSL is het acroniem voor Secure Socket Layer en zorgt ervoor dat je een beveiligde verbinding kan maken naar een andere computer. Dit is ook het protocol dat gebruikt wordt bij de beveiliging van HTTP, het HyperText Transfer Protocol, waardoor het HTTPS genoemd word: HyperText Transfer Protocol Secure. In het geval van puppet wordt het gebruikt om de verbinding tussen de puppetmaster en de puppet client te beveiligen, zodat niemand kan zien wat je aan het uitvoeren bent of het kan aanpassen.
%
Om dit alles te automatiseren is op zich niet zo'n groot probleem, het grootste probleem erbij is de beveiliging. Je kan uiteraard zonder beveiliging de configuraties ook beheren maar dan kunnen derden ook jouw configuraties bekijken en zien waar er eventuele zwakke punten zijn, om nog maar te zwijgen over eventuele reverse engineering tactieken waarmee ze via je configuration management systeem op je centrale server binnen geraken. Om dit alles te voorkomen maakt puppet gebruik van ssl-certificaten. SSL staat voor Secure Socket Layer en zorgt ervoor dat er een beveiligde verbinding gemaakt kan worden tussen jouw server en de clients die je wilt bedienen. De authenticatie verloopt de eerste keer (standaard) manueel. Vanaf dan gebeurt de gehele authenticatie-fase op de achtergrond. De authenticatie gebeurt via certificaten, namelijk een privaat en een publiek certificaat. Het private certificaat is enkel bekend door jouw server. Het publieke certificaat is zowel gekend door de client als de server. Bij de initi\"ele configuratie van de beveiliging, stuurt de client zijn publieke certificaat naar de server, de server tekent dat certificaat met zijn private sleutel en stuurt het dan terug naar de client. Vanaf nu kan de client configuraties downloaden van de server op basis van zijn hostnaam en de bijbehorende publieke sleutel. De server kan dan het publieke certificaat met zijn private sleutel ontcijferen en kijken of dit geldig is of niet.

\subsection{Facter}
Facter is een onafhankelijke cross-platform Ruby library, ontworpen om informatie te verzamelen over nodes en is voorhanden voor elk besturingssysteem dat Puppet ondersteunt. Facter is een lichtgewicht programma dat simpele informatie verzamelt over een node, dingen zoals de hostnaam, IP-adres, MAC-adres, SSH keys, hardware informatie, etc. Facter is ook zo ontworpen dat het compleet modulair is, zodat je zelf in een handomdraai je eigen "facts" kan schrijven. Je kan het in Puppet gebruiken om objecten of variabelen aan te passen op basis van een aantal criteria.
